# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**<%= namePascal %>** - <%= description %>
- **Type:** <%= type %>
- **Port:** <%= port %>
<% if (needsDatabase) { %>- **Database:** <%= databaseType %><% } %>
<% if (domain) { %>- **Domain:** <%= domain %><% } %>

## Development Commands

```bash
# Install dependencies
npm install

# Run development server
npm run dev

# Build for production
npm run build

# Run linting
npm run lint

# Type checking (if applicable)
npm run typecheck
```

## Architecture

```
<%= name %>/
├── src/                    # Source code
<% if (type === 'nextjs') { %>├── app/                    # Next.js App Router pages
├── components/             # React components
├── lib/                    # Utilities and shared code<% } %>
<% if (type === 'vite-react') { %>├── components/             # React components
├── hooks/                  # Custom React hooks
├── lib/                    # Utilities<% } %>
<% if (type === 'api') { %>├── routes/                 # API route handlers
├── middleware/             # Express middleware
├── lib/                    # Utilities<% } %>
<% if (needsDatabase) { %>├── prisma/                 # Database schema and migrations<% } %>
├── Dockerfile              # Production container
├── docker-compose.yml      # Local development with Docker
└── .github/workflows/      # CI/CD pipelines
```

## Critical Security Rules

### NEVER on VPS

| Prohibited Command | Why |
|-------------------|-----|
| `docker compose build` | Triggers massive parallel downloads |
| `docker build` | Same - can cause suspension |
| `npm install` / `npm ci` | Opens hundreds of connections |

### Safe Deployment Pattern

```
Developer → git push → GitHub Actions builds → ghcr.io → VPS pulls image
```

## Deployment

1. Push to main: `git push origin main`
2. GitHub Actions builds and pushes to ghcr.io
3. On VPS: `docker compose pull && docker compose up -d`

<% if (domain) { %>
### Production URLs
- App: https://<%= domain %>
- Health: https://<%= domain %>/api/health
<% } %>

## Testing

```bash
# Local validation (run before every commit)
npm run lint
npm run build

# Health check (after deployment)
curl -s https://<%= domain || 'localhost:' + port %>/api/health | jq
```

## Code Conventions

```yaml
TypeScript:
  - Strict mode enabled
  - Explicit types over 'any'
  - Interfaces for objects, types for unions

<% if (type === 'nextjs' || type === 'vite-react') { %>
React:
  - Functional components only
  - Named exports preferred
  - Custom hooks for shared logic
  - Tailwind for styling
<% } %>

Files:
  - kebab-case for files
  - PascalCase for components
  - camelCase for functions/variables

Git:
  - Conventional commits: feat|fix|docs|chore
  - Small, focused commits
```

## Troubleshooting

### 502 Bad Gateway
Check Traefik port matches app port in docker-compose.yml labels.

### 403 Forbidden (Static Sites)
File permissions: `chmod 644 files, chmod 755 directories`

### Database Connection Failed
Ensure container is on the database network.

---

*Generated by project-kickoff on <%= timestamp %>*
